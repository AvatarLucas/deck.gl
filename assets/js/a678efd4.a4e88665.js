"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[498],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>k});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),c=s(a),u=i,k=c["".concat(p,".").concat(u)]||c[u]||m[u]||r;return a?n.createElement(k,l(l({ref:t},d),{},{components:a})):n.createElement(k,l({ref:t},d))}));function k(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=u;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o[c]="string"==typeof e?e:i,l[1]=o;for(var s=2;s<r;s++)l[s]=a[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},30788:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>s});var n=a(87462),i=(a(67294),a(3905));const r={},l="fetchMap",o={unversionedId:"api-reference/carto/fetch-map",id:"api-reference/carto/fetch-map",title:"fetchMap",description:"CARTO Builder is a powerful tool for designing map visualizations. With the fetchMap function, you can easily instantiate layers configured in Builder for use with deck.gl. It is available starting with CARTO Maps API version v3 and deck.gl 8.7.",source:"@site/../docs/api-reference/carto/fetch-map.md",sourceDirName:"api-reference/carto",slug:"/api-reference/carto/fetch-map",permalink:"/docs/api-reference/carto/fetch-map",draft:!1,editUrl:"https://github.com/visgl/deck.gl/tree/master/website/../docs/api-reference/carto/fetch-map.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"BASEMAP",permalink:"/docs/api-reference/carto/basemap"},next:{title:"Data Sources",permalink:"/docs/api-reference/carto/data-sources"}},p={},s=[{value:"Usage",id:"usage",level:2},{value:"Static display of a CARTO map",id:"static-display-of-a-carto-map",level:3},{value:"Integration with CARTO basemaps",id:"integration-with-carto-basemaps",level:3},{value:"Parameters",id:"parameters",level:2},{value:"<code>cartoMapId</code> (string)",id:"cartomapid",level:4},{value:"<code>credentials</code> (object, optional)",id:"credentials",level:4},{value:"<code>headers</code> (object, optional)",id:"headers",level:4},{value:"<code>autoRefresh</code> (number, optional)",id:"autorefresh",level:4},{value:"<code>onNewData</code> (Function, Optional)",id:"onnewdata",level:4},{value:"Return value",id:"return-value",level:2},{value:"<code>id</code> (string)",id:"id",level:4},{value:"<code>title</code> (string)",id:"title",level:4},{value:"<code>description</code> (string)",id:"description",level:4},{value:"<code>createdAt</code> (string)",id:"createdat",level:4},{value:"<code>updatedAt</code> (string)",id:"updatedat",level:4},{value:"<code>initialViewState</code> (string)",id:"initialviewstate",level:4},{value:"<code>layers</code> (Layer[])",id:"layers",level:4},{value:"<code>basemap</code> (object)",id:"basemap",level:4},{value:"<code>stopAutoRefresh</code> (Function)",id:"stopautorefresh",level:4},{value:"Auto-refreshing",id:"auto-refreshing",level:2}],d={toc:s},c="wrapper";function m(e){let{components:t,...a}=e;return(0,i.kt)(c,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"fetchmap"},"fetchMap"),(0,i.kt)("p",null,"CARTO ",(0,i.kt)("a",{parentName:"p",href:"https://carto.com/builder/"},"Builder")," is a powerful tool for designing map visualizations. With the ",(0,i.kt)("inlineCode",{parentName:"p"},"fetchMap")," function, you can easily instantiate layers configured in Builder for use with deck.gl. It is available starting with CARTO Maps API version v3 and deck.gl 8.7."),(0,i.kt)("div",{align:"center"},(0,i.kt)("div",null,(0,i.kt)("img",{src:"https://raw.githubusercontent.com/visgl/deck.gl-data/master/images/docs/fetch-map.gif"}),(0,i.kt)("p",null,(0,i.kt)("i",null,"Loading a Builder map with deck.gl")))),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("h3",{id:"static-display-of-a-carto-map"},"Static display of a CARTO map"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import {Deck} from '@deck.gl/core';\nimport {fetchMap} from '@deck.gl/carto';\n\nconst cartoMapId = 'ff6ac53f-741a-49fb-b615-d040bc5a96b8';\nfetchMap({cartoMapId}).then(map => new Deck(map));\n")),(0,i.kt)("h3",{id:"integration-with-carto-basemaps"},"Integration with CARTO basemaps"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import { fetchMap } from '@deck.gl/carto';\nimport { MapboxOverlay } from '@deck.gl/mapbox';\nimport maplibregl from 'maplibre-gl';\n\nfetchMap({ cartoMapId }).then(({ basemap, layers }) => {\n  const map = new maplibregl.Map({\n    container: '...',\n    ...basemap?.props, // basemap.props contain all props required to setup basemap\n    interactive: true\n  })\n  const overlay = new MapboxOverlay({layers: result.layers});\n  map.addControl(overlay);\n})\n")),(0,i.kt)("h2",{id:"parameters"},"Parameters"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const map = await fetchMap({cartoMapId, credentials, autoRefresh, onNewData});\n")),(0,i.kt)("h4",{id:"cartomapid"},(0,i.kt)("inlineCode",{parentName:"h4"},"cartoMapId")," (string)"),(0,i.kt)("p",null,"Required. Identifier of map created in CARTO Builder."),(0,i.kt)("h4",{id:"credentials"},(0,i.kt)("inlineCode",{parentName:"h4"},"credentials")," (object, optional)"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/docs/api-reference/carto/overview#carto-credentials"},"CARTO Credentials")," to use in API requests."),(0,i.kt)("h4",{id:"headers"},(0,i.kt)("inlineCode",{parentName:"h4"},"headers")," (object, optional)"),(0,i.kt)("p",null,"Custom headers to include in the map instantiation requests."),(0,i.kt)("h4",{id:"autorefresh"},(0,i.kt)("inlineCode",{parentName:"h4"},"autoRefresh")," (number, optional)"),(0,i.kt)("p",null,"Interval in seconds at which to autoRefresh the data. If provided, ",(0,i.kt)("inlineCode",{parentName:"p"},"onNewData")," must also be provided."),(0,i.kt)("h4",{id:"onnewdata"},(0,i.kt)("inlineCode",{parentName:"h4"},"onNewData")," (Function, Optional)"),(0,i.kt)("p",null,"Callback function that will be invoked whenever data in layers is changed. If provided, ",(0,i.kt)("inlineCode",{parentName:"p"},"autoRefresh")," must also be provided."),(0,i.kt)("h2",{id:"return-value"},"Return value"),(0,i.kt)("p",null,"When invoked with a given ",(0,i.kt)("inlineCode",{parentName:"p"},"cartoMapId"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"fetchMap")," will retrieve the information about the map from CARTO, generate appropriate layers and populate them with data. The properties of the ",(0,i.kt)("inlineCode",{parentName:"p"},"map")," are as follows:"),(0,i.kt)("h4",{id:"id"},(0,i.kt)("inlineCode",{parentName:"h4"},"id")," (string)"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"cartoMapId"),"."),(0,i.kt)("h4",{id:"title"},(0,i.kt)("inlineCode",{parentName:"h4"},"title")," (string)"),(0,i.kt)("p",null,"The title given to the map in CARTO Builder."),(0,i.kt)("h4",{id:"description"},(0,i.kt)("inlineCode",{parentName:"h4"},"description")," (string)"),(0,i.kt)("p",null,"The description given to the map in CARTO Builder."),(0,i.kt)("h4",{id:"createdat"},(0,i.kt)("inlineCode",{parentName:"h4"},"createdAt")," (string)"),(0,i.kt)("p",null,"When the map was created."),(0,i.kt)("h4",{id:"updatedat"},(0,i.kt)("inlineCode",{parentName:"h4"},"updatedAt")," (string)"),(0,i.kt)("p",null,"When the map was last updated."),(0,i.kt)("h4",{id:"initialviewstate"},(0,i.kt)("inlineCode",{parentName:"h4"},"initialViewState")," (string)"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"/docs/developer-guide/views#view-state"},"view state"),"."),(0,i.kt)("h4",{id:"layers"},(0,i.kt)("inlineCode",{parentName:"h4"},"layers")," (Layer[])"),(0,i.kt)("p",null,"A collection of deck.gl ",(0,i.kt)("a",{parentName:"p",href:"/docs/api-reference/core/layer"},"layers"),"."),(0,i.kt)("h4",{id:"basemap"},(0,i.kt)("inlineCode",{parentName:"h4"},"basemap")," (object)"),(0,i.kt)("p",null,"An object describing the ",(0,i.kt)("a",{parentName:"p",href:"/docs/api-reference/carto/basemap#supported-basemaps"},"basemap")," configured in CARTO Builder."),(0,i.kt)("p",null,"Properties:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"type")," ",(0,i.kt)("strong",{parentName:"li"},"(string)")," - type of basemap: ",(0,i.kt)("inlineCode",{parentName:"li"},"'maplibre'")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"'google-maps'")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"props")," ",(0,i.kt)("strong",{parentName:"li"},"(string or object)")," - props that should be passed to basemap implementation",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"if ",(0,i.kt)("inlineCode",{parentName:"li"},"type")," is ",(0,i.kt)("inlineCode",{parentName:"li"},"'maplibre'")," then it contains",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"style")," ",(0,i.kt)("strong",{parentName:"li"},"(string or object)")," - URL of basemap style or style object if custom basemap is configured"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"center")," ",(0,i.kt)("strong",{parentName:"li"},"(","[number, number]",")")," - center of map as ",(0,i.kt)("inlineCode",{parentName:"li"},"[latitude, longitude]")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"zoom")," ",(0,i.kt)("strong",{parentName:"li"},"(number)")," - zoom level"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"pitch")," ",(0,i.kt)("strong",{parentName:"li"},"(number)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"bearing")," ",(0,i.kt)("strong",{parentName:"li"},"(number)")))),(0,i.kt)("li",{parentName:"ul"},"if ",(0,i.kt)("inlineCode",{parentName:"li"},"type")," is ",(0,i.kt)("inlineCode",{parentName:"li"},"'google-maps'"),", then it contains those props",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"mapTypeId")," ",(0,i.kt)("strong",{parentName:"li"},"(string)")," - type id of map"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"mapId")," ",(0,i.kt)("strong",{parentName:"li"},"(string, optional)")," - map id"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"center")," ",(0,i.kt)("strong",{parentName:"li"},"(object)")," - center of map as ",(0,i.kt)("inlineCode",{parentName:"li"},"{lat: number; lng: number}")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"zoom"),": ",(0,i.kt)("strong",{parentName:"li"},"(number)")," - zoom level (note, it has +1 offset applied versus deck.gl zoom)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tilt"),": ",(0,i.kt)("strong",{parentName:"li"},"(number)")," - tilt, same as ",(0,i.kt)("inlineCode",{parentName:"li"},"pitch")," in deck.gl API"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"heading"),": ",(0,i.kt)("strong",{parentName:"li"},"(number)")," - heading, same as ",(0,i.kt)("inlineCode",{parentName:"li"},"bearing")," in deck.gl API"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"rawStyle")," ",(0,i.kt)("strong",{parentName:"li"},"(string or object)")," - for ",(0,i.kt)("inlineCode",{parentName:"li"},"maplibre")," basemaps, original ",(0,i.kt)("inlineCode",{parentName:"li"},"style")," before applying layer filtering"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"visibleLayerGroups")," ",(0,i.kt)("strong",{parentName:"li"},"(object, optional)")," - layer groups to be displayed in the basemap."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"attribution")," ",(0,i.kt)("strong",{parentName:"li"},"(string, optional)")," - custom attribution HTML for this basemap")),(0,i.kt)("h4",{id:"stopautorefresh"},(0,i.kt)("inlineCode",{parentName:"h4"},"stopAutoRefresh")," (Function)"),(0,i.kt)("p",null,"A function to invoke to stop auto-refreshing. Only present if ",(0,i.kt)("inlineCode",{parentName:"p"},"autoRefresh")," option was provided to ",(0,i.kt)("inlineCode",{parentName:"p"},"fetchMap"),"."),(0,i.kt)("h2",{id:"auto-refreshing"},"Auto-refreshing"),(0,i.kt)("p",null,"With dynamic data sources, the ",(0,i.kt)("inlineCode",{parentName:"p"},"autoRefresh")," option to ",(0,i.kt)("inlineCode",{parentName:"p"},"fetchMap")," makes it simple to create an live-updating map."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const deck = new Deck({canvas: 'deck-canvas'});\nconst mapConfiguration = {\n  autoRefresh: 5,\n  cartoMapId,\n  onNewData: ({layers}) => {\n    deck.setProps({layers});\n  }\n};\n\nconst {initialViewState, layers, stopAutoRefresh} = await fetchMap(mapConfiguration);\ndeck.setProps({controller: true, initialViewState, layers});\n\nbuttonElement.addEventListener('click', () => {\n  stopAutoRefresh();\n});\n")))}m.isMDXComponent=!0}}]);